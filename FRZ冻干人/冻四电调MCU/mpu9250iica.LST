C51 COMPILER V9.00   MPU9250IICA                                                           07/27/2017 12:08:33 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE MPU9250IICA
OBJECT MODULE PLACED IN mpu9250iica.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE mpu9250iica.c LARGE BROWSE DEBUG OBJECTEXTEND

line level    source

   1          /****** **************/
   2          //#include <reg52.h>
   3          #include "UNIQ_ID.h"
   4          #include "Delay_12M.h"
   5          #include "mpu9250iica.h"
   6          
   7          
   8          //2017-06-06
   9          
  10          
  11          
  12          sbit SCL = P4 ^ 3;
  13          sbit SDA = P4 ^ 2;
  14          
  15          //Ö»½ÓµçÔ´ºÍIIC¡£Êµ²âµçÔ´ÓÃ5V£¬IOÓÃ3.3V¿É¹¤×÷¡£ÃèÊöÖÐ3ÖÁ5V¶¼¿É¹¤×÷¡£
  16          
  17          
  18          
  19          #define   bool unsigned char
  20          #define   TRUE 1
  21          #define   FALSE 0
  22          #define   u8 unsigned char
  23          #define   uchar unsigned char
  24          #define   uint unsigned int     
  25          #define   u32 unsigned long     
  26          
  27          // ¶¨ÒåMPU9250ÄÚ²¿µØÖ·
  28          //****************************************
  29          #define SMPLRT_DIV              0x19    //ÍÓÂÝÒÇ²ÉÑùÂÊ£¬µäÐÍÖµ£º0x07(125Hz)
  30          #define CONFIG                  0x1A    //µÍÍ¨ÂË²¨ÆµÂÊ£¬µäÐÍÖµ£º0x06(5Hz)
  31          #define GYRO_CONFIG             0x1B    //ÍÓÂÝÒÇ×Ô¼ì¼°²âÁ¿·¶Î§£¬µäÐÍÖµ£º0x18(²»×Ô¼ì£¬2000deg/s)
  32          #define ACCEL_CONFIG    0x1C    //¼ÓËÙ¼Æ×Ô¼ì¡¢²âÁ¿·¶Î§¼°¸ßÍ¨ÂË²¨ÆµÂÊ£¬µäÐÍÖµ£º0x01(²»×Ô¼ì£¬2G£¬5Hz)
  33          
  34          #define ACCEL_XOUT_H    0x3B
  35          #define ACCEL_XOUT_L    0x3C
  36          #define ACCEL_YOUT_H    0x3D
  37          #define ACCEL_YOUT_L    0x3E
  38          #define ACCEL_ZOUT_H    0x3F
  39          #define ACCEL_ZOUT_L    0x40
  40          
  41          #define TEMP_OUT_H              0x41
  42          #define TEMP_OUT_L              0x42
  43          
  44          #define GYRO_XOUT_H             0x43
  45          #define GYRO_XOUT_L             0x44    
  46          #define GYRO_YOUT_H             0x45
  47          #define GYRO_YOUT_L             0x46
  48          #define GYRO_ZOUT_H             0x47
  49          #define GYRO_ZOUT_L             0x48
  50          
  51                          
  52          #define MAG_XOUT_L              0x03
  53          #define MAG_XOUT_H              0x04
  54          #define MAG_YOUT_L              0x05
  55          #define MAG_YOUT_H              0x06
C51 COMPILER V9.00   MPU9250IICA                                                           07/27/2017 12:08:33 PAGE 2   

  56          #define MAG_ZOUT_L              0x07
  57          #define MAG_ZOUT_H              0x08
  58          
  59          
  60          #define PWR_MGMT_1              0x6B    //µçÔ´¹ÜÀí£¬µäÐÍÖµ£º0x00(Õý³£ÆôÓÃ)
  61          #define WHO_AM_I                  0x75  //IICµØÖ·¼Ä´æÆ÷(Ä¬ÈÏÊýÖµ0x68£¬Ö»¶Á)
  62          
  63          
  64          
  65          //****************************
  66          /*
  67          mpu9250ÄÚ²¿Îªmpu6500ºÍAK8963µÄ×éºÏ¡£ÊÇÁ½¸ö²»Í¬µÄI2CµØÖ·¡£¶ÁÈ¡¼ÓËÙ¶ÈºÍÍÓÂÝÒÇÐèÒª¶Ômpu6500µÄI2CµØÖ·¼°½øÐÐ²Ù×
             -÷£¬¶ÁÈ¡´ÅÁ¦¼ÆÐèÒª¶Ôak8963µØÖ·½øÐÐ²Ù×÷¡£
  68          mpu6500¸ù¾ÝµçÂ·ÖÐAD0µÄ²»Í¬£¬µØÖ·Îª0x68»òÕß0x69, ´ÅÁ¦¼ÆÎª0x0C£¨ÔÚmpu9250ÖÐ£¬µçÂ·ÒÑ¾­È·¶¨£¬µØÖ·ÎÞ·¨¸ü¸Ä£©¡£
  69          ÔÚ¶ÁÈ¡Ê±£¬×¢ÒâÐèÒªÈË¹¤½«µØÖ·×óÒÆÒ»Î»£¨I2C¶ÁÐ´Îª×ó¶ÔÆë£¬µÚ8Î»Òª´æ¶ÁÐ´±êÖ¾Î»£©£¬mpu6500Îª0xD0»òÊÇ0xD2,´ÅÁ¦¼Æ
             -Îª0x18£¨Èç¹ûI2C¶ÁÐ´ÖÐ½øÐÐÁË×óÒÆ²Ù×÷£¬ÄÇ¾Í²»ÓÃÈË¹¤×óÒÆÒ»Î»£©*/
  70          #define GYRO_ADDRESS   0xD0       //ÍÓÂÝµØÖ·
  71          #define MAG_ADDRESS    0x18   //´Å³¡µØÖ·
  72          #define ACCEL_ADDRESS  0xD0 
  73          
  74          
  75          
  76          static unsigned char BUF[10];       //½ÓÊÕÊý¾Ý»º´æÇø
  77          //static char  test=0;                           //IICÓÃµ½
  78          
  79          //short T_X,T_Y,T_Z,T_T;                 //X,Y,ZÖá£¬ÎÂ¶È
  80          static int T_X;
  81          static int T_Y;
  82          static int T_Z;
  83          static int T_T;          //X,Y,ZÖá£¬ÎÂ¶È
  84          
  85          
  86          float MPU9250RES_BUF[4];    // Êý¾Ý±£´æ´¦
  87          
  88          char MPU9250_readRC; //¶ÁÖ´ÐÐÕýÈ·´íÎó
  89          float *MPU9250RES_F; 
  90          int   *MPU9250RES_I;   
  91          char  MPU9250RES_TYPE = 0;  // 0=float type   1=int type
  92          
  93          //************************************
  94          /*Ä£ÄâIIC¶Ë¿ÚÊä³öÊäÈë¶¨Òå*/
  95          //#define SCL_H         GPIOB->BSRR = GPIO_Pin_6
  96          //#define SCL_L         GPIOB->BRR  = GPIO_Pin_6 
  97          //   
  98          //#define SDA_H         GPIOB->BSRR = GPIO_Pin_7
  99          //#define SDA_L         GPIOB->BRR  = GPIO_Pin_7
 100          //
 101          //#define SCL_read      GPIOB->IDR  & GPIO_Pin_6
 102          //#define SDA_read      GPIOB->IDR  & GPIO_Pin_7
 103          
 104          //
 105          //sbit SCL = P1 ^ 6;
 106          //sbit SDA = P3 ^ 4;
 107          
 108          
 109          #define SCL_H         SCL = 1
 110          #define SCL_L         SCL = 0
 111          #define SDA_H         SDA = 1
 112          #define SDA_L         SDA = 0
 113          //#define SCL_read      SCL
 114          #define SDA_read      SDA
 115          
C51 COMPILER V9.00   MPU9250IICA                                                           07/27/2017 12:08:33 PAGE 3   

 116          
 117          /*
 118          ********************************************************************************
 119          ** º¯Êý¹¦ÄÜ £º ³¤ÑÓÊ±º¯Êý       
 120          ********************************************************************************
 121          */
 122          static void Delayms(u32 m)
 123          {
 124   1        //u32 i;
 125   1        //
 126   1        //for(; m != 0; m--)  
 127   1        //     for (i=0; i<500; i++);
 128   1      
 129   1              DelayMs(m);
 130   1      }
 131          
 132          
 133          
 134          /*******************************************************************************
 135          * Function Name  : I2C_delay
 136          * Description    : Simulation IIC Timing series delay
 137          * Input          : None
 138          * Output         : None
 139          * Return         : None
 140          ****************************************************************************** */
 141          static void I2C_delay(void)
 142          {
 143   1         u8 i=66; 
 144   1         while(i) 
 145   1         { 
 146   2           i--; 
 147   2         }  
 148   1      }
 149          
 150          static void delay5ms(void)
 151          {
 152   1         //int i=5000;  
 153   1         //while(i) 
 154   1         //{ 
 155   1         //  i--; 
 156   1         //}  
 157   1      
 158   1              DelayMs(5);
 159   1      }
 160          
 161          
 162          /*******************************************************************************
 163          * Function Name  : I2C_Start
 164          * Description    : Master Start Simulation IIC Communication
 165          * Input          : None
 166          * Output         : None
 167          * Return         : Wheather      Start
 168          ****************************************************************************** */
 169          static bool I2C_Start(void)
 170          {
 171   1              SDA_H;
 172   1              I2C_delay();
 173   1              SCL_H;
 174   1              I2C_delay();
 175   1              if(!SDA_read)return FALSE;      //SDAÏßÎªµÍµçÆ½Ôò×ÜÏßÃ¦,ÍË³ö
 176   1              SDA_L;
 177   1              I2C_delay();
C51 COMPILER V9.00   MPU9250IICA                                                           07/27/2017 12:08:33 PAGE 4   

 178   1              if(SDA_read) return FALSE;      //SDAÏßÎª¸ßµçÆ½Ôò×ÜÏß³ö´í,ÍË³ö
 179   1              SDA_L;
 180   1              I2C_delay();
 181   1              return TRUE;
 182   1      }
 183          /*******************************************************************************
 184          * Function Name  : I2C_Stop
 185          * Description    : Master Stop Simulation IIC Communication
 186          * Input          : None
 187          * Output         : None
 188          * Return         : None
 189          ****************************************************************************** */
 190          static void I2C_Stop(void)
 191          {
 192   1              SCL_L;
 193   1              I2C_delay();
 194   1              SDA_L;
 195   1              I2C_delay();
 196   1              SCL_H;
 197   1              I2C_delay();
 198   1              SDA_H;
 199   1              I2C_delay();
 200   1      } 
 201          /*******************************************************************************
 202          * Function Name  : I2C_Ack
 203          * Description    : Master Send Acknowledge Single
 204          * Input          : None
 205          * Output         : None
 206          * Return         : None
 207          ****************************************************************************** */
 208          //static void I2C_Ack(void)
 209          //{     
 210          //      SCL_L;
 211          //      I2C_delay();
 212          //      SDA_L;
 213          //      I2C_delay();
 214          //      SCL_H;
 215          //      I2C_delay();
 216          //      SCL_L;
 217          //      I2C_delay();
 218          //}  
 219          
 220          /*******************************************************************************
 221          * Function Name  : I2C_NoAck
 222          * Description    : Master Send No Acknowledge Single
 223          * Input          : None
 224          * Output         : None
 225          * Return         : None
 226          ****************************************************************************** */
 227          static void I2C_NoAck(void)
 228          {       
 229   1              SCL_L;
 230   1              I2C_delay();
 231   1              SDA_H;
 232   1              I2C_delay();
 233   1              SCL_H;
 234   1              I2C_delay();
 235   1              SCL_L;
 236   1              I2C_delay();
 237   1      } 
 238          /*******************************************************************************
 239          * Function Name  : I2C_WaitAck
C51 COMPILER V9.00   MPU9250IICA                                                           07/27/2017 12:08:33 PAGE 5   

 240          * Description    : Master Reserive Slave Acknowledge Single
 241          * Input          : None
 242          * Output         : None
 243          * Return         : Wheather      Reserive Slave Acknowledge Single
 244          ****************************************************************************** */
 245          static bool I2C_WaitAck(void)    //·µ»ØÎª:=1ÓÐACK,=0ÎÞACK
 246          {
 247   1              SCL_L;
 248   1              I2C_delay();
 249   1              SDA_H;                  
 250   1              I2C_delay();
 251   1              SCL_H;
 252   1              I2C_delay();
 253   1              if(SDA_read)
 254   1              {
 255   2            SCL_L;
 256   2                I2C_delay();
 257   2            return FALSE;
 258   2              }
 259   1              SCL_L;
 260   1              I2C_delay();
 261   1              return TRUE;
 262   1      }
 263          /*******************************************************************************
 264          * Function Name  : I2C_SendByte
 265          * Description    : Master Send a Byte to Slave
 266          * Input          : Will Send Date
 267          * Output         : None
 268          * Return         : None
 269          ****************************************************************************** */
 270          static void I2C_SendByte(u8 SendByte) //Êý¾Ý´Ó¸ßÎ»µ½µÍÎ»//
 271          {
 272   1          u8 i=8;
 273   1          while(i--)
 274   1          {
 275   2              SCL_L;
 276   2              I2C_delay();
 277   2            if(SendByte&0x80)
 278   2              SDA_H;  
 279   2            else 
 280   2              SDA_L;   
 281   2              SendByte<<=1;
 282   2              I2C_delay();
 283   2                      SCL_H;
 284   2              I2C_delay();
 285   2          }
 286   1          SCL_L;
 287   1              I2C_delay();
 288   1      }  
 289          /*******************************************************************************
 290          * Function Name  : I2C_RadeByte
 291          * Description    : Master Reserive a Byte From Slave
 292          * Input          : None
 293          * Output         : None
 294          * Return         : Date From Slave 
 295          ****************************************************************************** */
 296          static unsigned char I2C_RadeByte(void)  //Êý¾Ý´Ó¸ßÎ»µ½µÍÎ»//
 297          { 
 298   1          u8 i=8;
 299   1          u8 ReceiveByte=0;
 300   1      
 301   1          SDA_H;                              
C51 COMPILER V9.00   MPU9250IICA                                                           07/27/2017 12:08:33 PAGE 6   

 302   1              I2C_delay();
 303   1          while(i--)
 304   1          {
 305   2            ReceiveByte<<=1;      
 306   2            SCL_L;
 307   2            I2C_delay();
 308   2                SCL_H;
 309   2            I2C_delay();      
 310   2            if(SDA_read)
 311   2            {
 312   3              ReceiveByte|=0x01;
 313   3            }
 314   2          }
 315   1          SCL_L;
 316   1              I2C_delay();
 317   1          return ReceiveByte;
 318   1      } 
 319          //ZRX          
 320          //µ¥×Ö½ÚÐ´Èë*******************************************
 321          
 322          static bool Single_Write(unsigned char SlaveAddress,unsigned char REG_Address,unsigned char REG_data)              
             -  //void
 323          {
 324   1              if(!I2C_Start())return FALSE;
 325   1          I2C_SendByte(SlaveAddress);   //·¢ËÍÉè±¸µØÖ·+Ð´ÐÅºÅ//I2C_SendByte(((REG_Address & 0x0700) >>7) | Slave
             -Address & 0xFFFE);//ÉèÖÃ¸ßÆðÊ¼µØÖ·+Æ÷¼þµØÖ· 
 326   1          if(!I2C_WaitAck()){I2C_Stop(); return FALSE;}
 327   1          I2C_SendByte(REG_Address );   //ÉèÖÃµÍÆðÊ¼µØÖ·      
 328   1          I2C_WaitAck();      
 329   1          I2C_SendByte(REG_data);
 330   1          I2C_WaitAck();   
 331   1          I2C_Stop(); 
 332   1          delay5ms();
 333   1          return TRUE;
 334   1      }
 335          
 336          //µ¥×Ö½Ú¶ÁÈ¡*****************************************
 337          static unsigned char Single_Read(unsigned char SlaveAddress,unsigned char REG_Address)
 338          {   unsigned char REG_data;             
 339   1              if(!I2C_Start())return MPU9250_readRC=FALSE;
 340   1          I2C_SendByte(SlaveAddress); //I2C_SendByte(((REG_Address & 0x0700) >>7) | REG_Address & 0xFFFE);//ÉèÖÃ
             -¸ßÆðÊ¼µØÖ·+Æ÷¼þµØÖ· 
 341   1          if(!I2C_WaitAck())
 342   1              {
 343   2                      I2C_Stop();
 344   2                      //test=1; 
 345   2                      return MPU9250_readRC=FALSE;
 346   2              }
 347   1          I2C_SendByte((u8) REG_Address);   //ÉèÖÃµÍÆðÊ¼µØÖ·      
 348   1          I2C_WaitAck();
 349   1          I2C_Start();
 350   1          I2C_SendByte(SlaveAddress+1);
 351   1          I2C_WaitAck();
 352   1      
 353   1              REG_data= I2C_RadeByte();
 354   1          I2C_NoAck();
 355   1          I2C_Stop();
 356   1          MPU9250_readRC= TRUE;
 357   1              return REG_data;
 358   1      
 359   1      }                                                     
 360          
C51 COMPILER V9.00   MPU9250IICA                                                           07/27/2017 12:08:33 PAGE 7   

 361          
 362          
 363          
 364          //³õÊ¼»¯MPU9250£¬¸ù¾ÝÐèÒªÇë²Î¿¼pdf½øÐÐÐÞ¸Ä************************
 365          void Init_MPU9250(void)
 366          {
 367   1      
 368   1              MPU9250RES_F = MPU9250RES_BUF; 
 369   1              MPU9250RES_I = (int*)MPU9250RES_F;
 370   1              MPU9250RES_TYPE = 0;
 371   1      
 372   1      /*
 373   1         Single_Write(GYRO_ADDRESS,PWR_M, 0x80);   //
 374   1         Single_Write(GYRO_ADDRESS,SMPL, 0x07);    //
 375   1         Single_Write(GYRO_ADDRESS,DLPF, 0x1E);    //¡À2000¡ã
 376   1         Single_Write(GYRO_ADDRESS,INT_C, 0x00 );  //
 377   1         Single_Write(GYRO_ADDRESS,PWR_M, 0x00);   //
 378   1      */
 379   1        Single_Write(GYRO_ADDRESS,PWR_MGMT_1, 0x00);  //½â³ýÐÝÃß×´Ì¬
 380   1              Single_Write(GYRO_ADDRESS,SMPLRT_DIV, 0x07);
 381   1              Single_Write(GYRO_ADDRESS,CONFIG, 0x06);
 382   1              Single_Write(GYRO_ADDRESS,GYRO_CONFIG, 0x18);
 383   1              Single_Write(GYRO_ADDRESS,ACCEL_CONFIG, 0x01);
 384   1        //----------------
 385   1      //      Single_Write(GYRO_ADDRESS,0x6A,0x00);//close Master Mode        
 386   1      
 387   1      }
 388          
 389                  
 390          //******¶ÁÈ¡MPU9250Êý¾Ý****************************************
 391          void READ_MPU9250_ACCEL(void)
 392          { 
 393   1      
 394   1         BUF[0]=Single_Read(ACCEL_ADDRESS,ACCEL_XOUT_L); if( MPU9250_readRC==FALSE ) return;
 395   1         BUF[1]=Single_Read(ACCEL_ADDRESS,ACCEL_XOUT_H); if( MPU9250_readRC==FALSE ) return;
 396   1         T_X= (BUF[1]<<8)|BUF[0];
 397   1         //T_X/=164;  
 398   1         if( MPU9250RES_TYPE == 1 ) MPU9250RES_I[0] = T_X;
 399   1         if( MPU9250RES_TYPE == 0 ) MPU9250RES_F[0] = (float)T_X/164.0;          //¶ÁÈ¡¼ÆËãXÖáÊý¾Ý
 400   1      
 401   1         BUF[2]=Single_Read(ACCEL_ADDRESS,ACCEL_YOUT_L); if( MPU9250_readRC==FALSE ) return;
 402   1         BUF[3]=Single_Read(ACCEL_ADDRESS,ACCEL_YOUT_H); if( MPU9250_readRC==FALSE ) return;
 403   1         T_Y= (BUF[3]<<8)|BUF[2];
 404   1         //T_Y/=164;                                             //¶ÁÈ¡¼ÆËãYÖáÊý¾Ý
 405   1         if( MPU9250RES_TYPE == 1 ) MPU9250RES_I[1] = T_Y;
 406   1         if( MPU9250RES_TYPE == 0 ) MPU9250RES_F[1] = (float)T_Y/164.0; 
 407   1      
 408   1         BUF[4]=Single_Read(ACCEL_ADDRESS,ACCEL_ZOUT_L); if( MPU9250_readRC==FALSE ) return;
 409   1         BUF[5]=Single_Read(ACCEL_ADDRESS,ACCEL_ZOUT_H); if( MPU9250_readRC==FALSE ) return;
 410   1         T_Z= (BUF[5]<<8)|BUF[4];
 411   1         //T_Z/=164;                                         //¶ÁÈ¡¼ÆËãZÖáÊý¾Ý
 412   1         if( MPU9250RES_TYPE == 1 ) MPU9250RES_I[2] = T_Z;
 413   1         if( MPU9250RES_TYPE == 0 ) MPU9250RES_F[2] = (float)T_Z/164.0; 
 414   1       
 415   1      }
 416          
 417          
 418          void READ_MPU9250_GYRO(void)
 419          { 
 420   1      
 421   1         BUF[0]=Single_Read(GYRO_ADDRESS,GYRO_XOUT_L);  if( MPU9250_readRC==FALSE ) return;
 422   1         BUF[1]=Single_Read(GYRO_ADDRESS,GYRO_XOUT_H); if( MPU9250_readRC==FALSE ) return;
C51 COMPILER V9.00   MPU9250IICA                                                           07/27/2017 12:08:33 PAGE 8   

 423   1         T_X= (BUF[1]<<8)|BUF[0];
 424   1         //T_X/=16.4;                                                    //¶ÁÈ¡¼ÆËãXÖáÊý¾Ý
 425   1         if( MPU9250RES_TYPE == 1 ) MPU9250RES_I[0] = T_X;
 426   1         if( MPU9250RES_TYPE == 0 ) MPU9250RES_F[0] = (float)T_X/16.40;  
 427   1      
 428   1         BUF[2]=Single_Read(GYRO_ADDRESS,GYRO_YOUT_L); if( MPU9250_readRC==FALSE ) return;
 429   1         BUF[3]=Single_Read(GYRO_ADDRESS,GYRO_YOUT_H); if( MPU9250_readRC==FALSE ) return;
 430   1         T_Y= (BUF[3]<<8)|BUF[2];
 431   1         //T_Y/=16.4;                                                    //¶ÁÈ¡¼ÆËãYÖáÊý¾Ý
 432   1         if( MPU9250RES_TYPE == 1 ) MPU9250RES_I[1] = T_Y;
 433   1         if( MPU9250RES_TYPE == 0 ) MPU9250RES_F[1] = (float)T_Y/16.40; 
 434   1      
 435   1         BUF[4]=Single_Read(GYRO_ADDRESS,GYRO_ZOUT_L); if( MPU9250_readRC==FALSE ) return;
 436   1         BUF[5]=Single_Read(GYRO_ADDRESS,GYRO_ZOUT_H); if( MPU9250_readRC==FALSE ) return;
 437   1         T_Z= (BUF[5]<<8)|BUF[4];
 438   1         //T_Z/=16.4;                                                //¶ÁÈ¡¼ÆËãZÖáÊý¾Ý
 439   1         if( MPU9250RES_TYPE == 1 ) MPU9250RES_I[2] = T_Z;
 440   1         if( MPU9250RES_TYPE == 0 ) MPU9250RES_F[2] = (float)T_Z/16.4; 
 441   1       
 442   1       
 443   1      
 444   1      
 445   1         BUF[6]=Single_Read(GYRO_ADDRESS,TEMP_OUT_L);  if( MPU9250_readRC==FALSE ) return;
 446   1         BUF[7]=Single_Read(GYRO_ADDRESS,TEMP_OUT_H);  if( MPU9250_readRC==FALSE ) return;
 447   1         T_T=(BUF[7]<<8)|BUF[6];
 448   1         //T_T = 35+ ((float) (T_T + 13200)) / 280;// ¶ÁÈ¡¼ÆËã³öÎÂ¶È
 449   1         if( MPU9250RES_TYPE == 1 ) MPU9250RES_I[3] = T_T;
 450   1         if( MPU9250RES_TYPE == 0 ) MPU9250RES_F[3] = 35 + ((float) (T_T + 13200L)) / 280.0;// ¶ÁÈ¡¼ÆËã³öÎÂ¶È
 451   1      }
 452          
 453          
 454          void READ_MPU9250_MAG(void)
 455          { 
 456   1         Single_Write(GYRO_ADDRESS,0x37,0x02);//turn on Bypass Mode 
 457   1         Delayms(10); 
 458   1         Single_Write(MAG_ADDRESS,0x0A,0x01);
 459   1         Delayms(10); 
 460   1         BUF[0]=Single_Read (MAG_ADDRESS,MAG_XOUT_L); if( MPU9250_readRC==FALSE ) return;
 461   1         BUF[1]=Single_Read (MAG_ADDRESS,MAG_XOUT_H); if( MPU9250_readRC==FALSE ) return;
 462   1         T_X=(BUF[1]<<8)|BUF[0];
 463   1         if( MPU9250RES_TYPE == 1 ) MPU9250RES_I[0] = T_X;
 464   1         if( MPU9250RES_TYPE == 0 ) MPU9250RES_F[0] = (float)T_X;  
 465   1      
 466   1         BUF[2]=Single_Read(MAG_ADDRESS,MAG_YOUT_L); if( MPU9250_readRC==FALSE ) return;
 467   1         BUF[3]=Single_Read(MAG_ADDRESS,MAG_YOUT_H); if( MPU9250_readRC==FALSE ) return;
 468   1         T_Y= (BUF[3]<<8)|BUF[2];                                                //¶ÁÈ¡¼ÆËãYÖáÊý¾Ý
 469   1         if( MPU9250RES_TYPE == 1 ) MPU9250RES_I[1] = T_Y;
 470   1         if( MPU9250RES_TYPE == 0 ) MPU9250RES_F[1] = (float)T_Y;  
 471   1               
 472   1         BUF[4]=Single_Read(MAG_ADDRESS,MAG_ZOUT_L); if( MPU9250_readRC==FALSE ) return;
 473   1         BUF[5]=Single_Read(MAG_ADDRESS,MAG_ZOUT_H); if( MPU9250_readRC==FALSE ) return;
 474   1         T_Z= (BUF[5]<<8)|BUF[4];                                            //¶ÁÈ¡¼ÆËãZÖáÊý¾Ý
 475   1         if( MPU9250RES_TYPE == 1 ) MPU9250RES_I[2] = T_Z;
 476   1         if( MPU9250RES_TYPE == 0 ) MPU9250RES_F[2] = (float)T_Z;  
 477   1      }
 478          
 479          
 480          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   1778    ----
C51 COMPILER V9.00   MPU9250IICA                                                           07/27/2017 12:08:33 PAGE 9   

   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =     42    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)

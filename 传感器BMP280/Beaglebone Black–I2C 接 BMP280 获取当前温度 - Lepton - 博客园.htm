<!DOCTYPE html>
<!--STATUS OK-->
<html lang="zh-cn"><head><meta http-equiv="Content-Type" content="text/html; charset=gbk">
<!-- base href="http://www.cnblogs.com/leptonation/p/5210331.html" -->
<style>
body{position:relative}
body,form{margin:0!important;padding:0!important}
#bd_snap{font:13px arial;color:#000;background:#fff;text-align:left;padding:13px 0 0 20px}
#bd_snap_txt{clear:both;padding:10px 0 2px;line-height:24px;color:#333}
#bd_snap_note{color:#999;padding-bottom:10px}
#bd_snap a{font:13px arial;color:#00c;text-decoration:underline}
#bd_snap_note a{color:#999}
#bd_snap_head{width:860px;height:44px}
#bd_snap_logo{width:162px;height:38px;display:block;background:url(http://www.baidu.com/img/logo-snap.png) no-repeat;margin-right:15px;float:left}
#bd_snap_search{width:680px;position:absolute;left:209px;top:17px}
#bd_snap_kw{width:531px;margin-right: 0;height:24px;padding:4px 7px;padding:6px 7px 2px\9;font:16px arial;vertical-align:top;border: 1px solid #b6b6b6;border-color: #7b7b7b #b6b6b6 #b6b6b6 #7b7b7b;background: #fff;display:inline-block;border-right-width: 0;border-color: #b8b8b8 transparent #ccc #b8b8b8;overflow: hidden;outline:0}
#bd_snap_kw:hover{border-color: #999 transparent #b3b3b3 #999;}
#bd_snap_kw:focus{border-color: #4791ff transparent #4791ff #4791ff}
#bd_snap_su{width:100px;height:34px;font-size:14px;color:#fff;padding:0;letter-spacing: 1px;background: #3385ff; border-bottom: 1px solid #2d78f4;outline: medium;-webkit-appearance: none;-webkit-border-radius: 0;cursor:pointer;border:0}
#bd_snap_search input.bd_snap_btn_h{background: #3075dc;box-shadow: inset 1px 1px 3px #2964bb;-webkit-box-shadow: inset 1px 1px 3px #2964bb;-moz-box-shadow: inset 1px 1px 3px #2964bb;-o-box-shadow: inset 1px 1px 3px #2964bb;}
#bd_snap_search input.btnhover{background: #317ef3;border-bottom: 1px solid #2868c8;box-shadow: 1px 1px 1px #ccc;}
#bd_snap_btn_wr{width:97px;height:34px;display:inline-block;_top:1px;*position:relative}
#bd_snap_ln{height:1px;border-top:1px solid #ACA899;background:#ECE9D8;overflow:hidden}
#bd_snap_txt span a{text-decoration:none}
</style>


</head><body><div id="bd_snap">
    <div id="bd_snap_head">
        <a href="http://www.baidu.com/" id="bd_snap_logo" title="到百度首页"></a>
    </div>
    <div id="bd_snap_txt">您查询的关键词是：<span><a style="color:black;background-color:#ffff66;padding:0 3px;font-weight:bold" href="http://cache.baiducontent.com/c?m=9f65cb4a8c8507ed4fece763105392230e54f73260878e482a958448e435061e5a38b4f9617f4c57959e213b1ced545beaf33473360037b7ec92ce1583afd7756fde28642f5e914062d313addc4654c623875b99b869e6ad814384d8d0c4ab54&amp;p=c07dc64ad48150ff57ed947c4a51bb&amp;newp=c96ec90c85cc43f408e2947e0f4fcd231610db2151d7d6106b82c825d7331b001c3bbfb423241000d6c37e6602a54c5fe9fa307032072ba3dda5c91d9fb4c57479d3&amp;user=baidu&amp;fm=sc&amp;query=bmp280+51%B3%CC%D0%F2&amp;qid=b43821ed00007ce1&amp;p1=11#baidusnap0">bmp280</a><a style="color:black;background-color:#99ff99;padding:0 3px;font-weight:bold" href="http://cache.baiducontent.com/c?m=9f65cb4a8c8507ed4fece763105392230e54f73260878e482a958448e435061e5a38b4f9617f4c57959e213b1ced545beaf33473360037b7ec92ce1583afd7756fde28642f5e914062d313addc4654c623875b99b869e6ad814384d8d0c4ab54&amp;p=c07dc64ad48150ff57ed947c4a51bb&amp;newp=c96ec90c85cc43f408e2947e0f4fcd231610db2151d7d6106b82c825d7331b001c3bbfb423241000d6c37e6602a54c5fe9fa307032072ba3dda5c91d9fb4c57479d3&amp;user=baidu&amp;fm=sc&amp;query=bmp280+51%B3%CC%D0%F2&amp;qid=b43821ed00007ce1&amp;p1=11#baidusnap2">51</a></span>  <span style="margin-left:5px">以下是该网页在北京时间 2017年05月04日 22:59:38 的快照；</span>
        <p>如果打开速度慢，可以尝试<a href="http://cache.baiducontent.com/c?m=9f65cb4a8c8507ed4fece763105392230e54f73260878e482a958448e435061e5a38b4f9617f4c57959e213b1ced545beaf33473360037b7ec92ce1583afd7756fde28642f5e914062d313addc4654c623875b99b869e6ad814384d8d0c4ab54&amp;p=c07dc64ad48150ff57ed947c4a51bb&amp;newp=c96ec90c85cc43f408e2947e0f4fcd231610db2151d7d6106b82c825d7331b001c3bbfb423241000d6c37e6602a54c5fe9fa307032072ba3dda5c91d9fb4c57479d3&amp;user=baidu&amp;fm=sc&amp;query=bmp280+51%B3%CC%D0%F2&amp;qid=b43821ed00007ce1&amp;p1=11&amp;fast=y">快速版</a>；如果想更新或删除快照，可以<a href="http://tousu.baidu.com/webmaster/add?link=http%3A%2F%2Fcache.baiducontent.com%2Fc%3Fm%3D9f65cb4a8c8507ed4fece763105392230e54f73260878e482a958448e435061e5a38b4f9617f4c57959e213b1ced545beaf33473360037b7ec92ce1583afd7756fde28642f5e914062d313addc4654c623875b99b869e6ad814384d8d0c4ab54%26p%3Dc07dc64ad48150ff57ed947c4a51bb%26newp%3Dc96ec90c85cc43f408e2947e0f4fcd231610db2151d7d6106b82c825d7331b001c3bbfb423241000d6c37e6602a54c5fe9fa307032072ba3dda5c91d9fb4c57479d3%26user%3Dbaidu%26fm%3Dsc%26query%3Dbmp280%2B51%25B3%25CC%25D0%25F2%26qid%3Db43821ed00007ce1%26p1%3D11" id="bd_tousu">投诉快照</a>。
        </p>
    </div>
<script>document.getElementById("bd_tousu").href = "http://tousu.baidu.com/webmaster/add?link=" + encodeURIComponent(document.location);</script>
    <div id="bd_snap_note">百度和网页 <a href="http://www.cnblogs.com/leptonation/p/5210331.html">http://www.cnblogs.com/leptonation/p/5210331.html</a> 的作者无关，不对其内容负责。百度快照谨为网络故障时之索引，不代表被搜索网站的即时页面。</div>
</div>
<div id="bd_snap_search">
	<form action="http://www.baidu.com/s"><input name="cl" value="3" type="hidden"><input name="wd" id="bd_snap_kw" maxlength="100"><span id="bd_snap_btn_wr"><input id="bd_snap_su" value="百度一下" class="bd_snap_btn" onmouseover="this.className='bd_snap_btn bd_snap_btn_h'" onmousedown="this.className='bd_snap_btn btnhover'" onmouseup="this.className='bd_snap_btn'" onmouseout="this.className='bd_snap_btn'" type="submit"></span></form>
</div>
<div id="bd_snap_ln"></div>
<div style="position:relative">




<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Beaglebone BlackCI2C 接 BMP280 获取当前温度 - Lepton - 博客园</title>
<link type="text/css" rel="stylesheet" href="Beaglebone%20Black%E2%80%93I2C%20%E6%8E%A5%20BMP280%20%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E6%B8%A9%E5%BA%A6%20-%20Lepton%20-%20%E5%8D%9A%E5%AE%A2%E5%9B%AD_files/blog-common.css">
<link type="text/css" rel="stylesheet" href="Beaglebone%20Black%E2%80%93I2C%20%E6%8E%A5%20BMP280%20%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E6%B8%A9%E5%BA%A6%20-%20Lepton%20-%20%E5%8D%9A%E5%AE%A2%E5%9B%AD_files/66251.css">
<link id="mobile-style" media="only screen and (max-width: 768px)" type="text/css" rel="stylesheet" href="Beaglebone%20Black%E2%80%93I2C%20%E6%8E%A5%20BMP280%20%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E6%B8%A9%E5%BA%A6%20-%20Lepton%20-%20%E5%8D%9A%E5%AE%A2%E5%9B%AD_files/bundle-Custom-mobile.css">
<link title="RSS" type="application/rss+xml" rel="alternate" href="http://www.cnblogs.com/leptonation/rss">
<link title="RSD" type="application/rsd+xml" rel="EditURI" href="http://www.cnblogs.com/leptonation/rsd.xml">
<link type="application/wlwmanifest+xml" rel="wlwmanifest" href="http://www.cnblogs.com/leptonation/wlwmanifest.xml">
  




<a name="top"></a>
<!--PageBeginHtml Block Begin-->






<style media="print">
#sub, .LeftCell, #digg_block, #comment_form, #sideBar{
display:none;
}
</style>
<!--PageBeginHtml Block End-->

<!--done-->
<div id="home">
<div id="header">
	<div id="blogTitle">
	<a id="lnkBlogLogo" href="http://www.cnblogs.com/leptonation/"><img id="blogLogo" src="Beaglebone%20Black%E2%80%93I2C%20%E6%8E%A5%20BMP280%20%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E6%B8%A9%E5%BA%A6%20-%20Lepton%20-%20%E5%8D%9A%E5%AE%A2%E5%9B%AD_files/logo.gif" alt="返回主页"></a>			
		
<!--done-->
<h1><a id="Header1_HeaderTitle" class="headermaintitle" href="http://www.cnblogs.com/leptonation/">Leptonation</a></h1>
<h2>Scientia et cognitionis (C#, WPF, MVVM, WCF, Javascript, Electronics)</h2>



		
	</div><!--end: blogTitle 博客的标题和副标题 -->
	<div id="navigator">
		
<ul id="navList">
<li></li>
<li><a id="blog_nav_myhome" class="menu" href="http://www.cnblogs.com/leptonation/">首页</a></li>
<li><a id="blog_nav_newpost" class="menu" rel="nofollow" href="https://i.cnblogs.com/EditPosts.aspx?opt=1">新随笔</a></li>
<li><a id="blog_nav_contact" class="menu" rel="nofollow" href="https://msg.cnblogs.com/send/Lepton">联系</a></li>
<li><a id="blog_nav_rss" class="menu" href="http://www.cnblogs.com/leptonation/rss">订阅</a>
<!--<a id="blog_nav_rss_image" class="aHeaderXML" href="http://www.cnblogs.com/leptonation/rss"><img src="//www.cnblogs.com/images/xml.gif" alt="订阅" /></a>--></li>
<li><a id="blog_nav_admin" class="menu" rel="nofollow" href="https://i.cnblogs.com/">管理</a></li>
</ul>
		<div class="blogStats">
			
			<div id="blog_stats">
<span id="stats_post_count">随笔 - 31&nbsp; </span>
<span id="stats_article_count">文章 - 1&nbsp; </span>
<span id="stats-comment_count">评论 - 37</span>
</div>
			
		</div><!--end: blogStats -->
	</div><!--end: navigator 博客导航栏 -->
</div><!--end: header 头部 -->

<div id="main">
	<div id="mainContent">
	<div class="forFlow">
		
<div id="post_detail">
<!--done-->
<div id="topics">
	<div class="post">
		<h1 class="postTitle">
			<a name="baidusnap0"></a><a id="cb_post_title_url" class="postTitle2" href="http://www.cnblogs.com/leptonation/p/5210331.html">Beaglebone BlackCI2C 接 <b style="color:black;background-color:#ffff66">BMP280</b> 获取当前温度</a>
		</h1>
		<div class="clear"></div>
		<div class="postBody">
			<div id="cnblogs_post_body"><p><span style="font-size: small"><span style="font-size: medium"><span style="font-size: small">我有两个含温度传感的模块，一个是AOSONG 奥松电子的 AM2320 温度湿度，另一个是九轴里面的 Bosch <b style="color:black;background-color:#ffff66">BMP280</b>。
由于 AM2320 用 I2C MODBUS，直接用 I2C Tools 它不理我，扫描后地址没在总线出现，不知道是它没实现 SMBus 
还是要给它功能码 0x03 唤醒才有东西，代码我还没写出来（其实到现在我都不知道是传感器坏了还是姿势不对），AM2320 稍后再试。</span></span></span></p>  <p>&nbsp;</p>  <h2>GY-91 MPU9250+<b style="color:black;background-color:#ffff66">BMP280</b></h2>  <p><span style="font-size: small"><span style="font-size: medium"><span style="font-size: small">先玩个容易一点的，<b style="color:black;background-color:#ffff66">BMP280</b>，温度与气压传感芯片。BBB 和 <b style="color:black;background-color:#ffff66">BMP280</b> 都是 3.3V，不需要逻辑转换，方便。这次我只看温度，气压读取除了地址和代码外其他操作大致相同。</span></span></span></p>  <p><a href="http://images2015.cnblogs.com/blog/112893/201602/112893-20160223161724568-993576985.png"><span style="font-size: small"><span style="font-size: medium"><span style="font-size: small"><img title="image" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-top-width: 0px" alt="image" src="Beaglebone%20Black%E2%80%93I2C%20%E6%8E%A5%20BMP280%20%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E6%B8%A9%E5%BA%A6%20-%20Lepton%20-%20%E5%8D%9A%E5%AE%A2%E5%9B%AD_files/112893-20160223161725630-1423292125.png" height="262" width="447" border="0"></span></span></span></a></p>  <p><span style="font-size: small"><span style="font-size: medium"><span style="font-size: small">虽说二合一方便，但还是好贵…。耗那么多买这个当然是为了做灰机，做出来之前要学习，首先是 I2C。问客服拿原理图，给了我这个：</span></span></span></p>  <p><a href="http://images2015.cnblogs.com/blog/112893/201602/112893-20160223161727130-386972231.png"><span style="font-size: small"><span style="font-size: medium"><span style="font-size: small"><img title="image" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-top-width: 0px" alt="image" src="Beaglebone%20Black%E2%80%93I2C%20%E6%8E%A5%20BMP280%20%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E6%B8%A9%E5%BA%A6%20-%20Lepton%20-%20%E5%8D%9A%E5%AE%A2%E5%9B%AD_files/112893-20160223161728990-2110098615.png" height="591" width="657" border="0"></span></span></span></a></p>  <p><span style="font-size: small"><span style="font-size: medium"><span style="font-size: small">看到 MPU9250 的 SDO 有下拉，但不知道是不是跟 <b style="color:black;background-color:#ffff66">BMP280</b> 的 SDO 一起的，后面检查地址时候发现，应该是的。从原理图看到 SDA 和 SCL 都有上拉接了个 4.7KΩ，自己连时候就SDA与SCL都不需上拉电阻，直接插 BBB，方便。好，开始动手。</span></span></span></p>  <p>&nbsp;</p>  <h2>接线</h2>  <p><span style="font-size: small"><span style="font-size: medium"><span style="font-size: small">默认 BBB 开机后 I2C-1 已经启用，地址不冲突就直接插来试试。P9_20 接 SDA，P9_19 接 SCL，P9_1 GND，P9_3 3V3，上电后含<b style="color:black;background-color:#ffff66">BMP280</b>的九轴模块 LED 绿灯亮起。</span></span></span></p>  <p><a href="http://images2015.cnblogs.com/blog/112893/201602/112893-20160223163035240-37621488.jpg"><span style="font-size: small"><span style="font-size: medium"><img title="DSC_0018(1)" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-top-width: 0px" alt="DSC_0018(1)" src="Beaglebone%20Black%E2%80%93I2C%20%E6%8E%A5%20BMP280%20%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E6%B8%A9%E5%BA%A6%20-%20Lepton%20-%20%E5%8D%9A%E5%AE%A2%E5%9B%AD_files/112893-20160223163036068-1685639992.jpg" height="395" width="699" border="0"></span></span></a></p>  <p>&nbsp;</p>  <h2>命令行工具 i2c-tools</h2>  <p><span style="font-size: small"><span style="font-size: medium"><span style="font-size: small">BBB 自带的 i2c-tools 共有四个命令，用它们就不用写代码也能与从机交互：</span></span></span></p>  <p><span style="font-size: small"><span style="font-size: medium"><span style="font-size: small">i2cdetect 检查元件地址和i2c slots          <br>i2cdump 倒出所有 register 值           <br>i2cset 对 register 写入值           <br>i2cget 从 register 取出值</span></span></span></p>  <p><span style="font-size: small"><span style="font-size: medium"><span style="font-size: small">除非特别说明，以下全部图片和内容的地址和值都是 HEX，16进位。看看，I2C-1 当前元件，用 I2C Detect 工具，列出 i2c-1 的所有从机：</span></span></span></p>  <p>&nbsp;</p>  <h2>扫描总线上的从机地址</h2>  <p><span style="font-family: consolas"><span style="font-size: small"><span style="font-size: medium"><span style="font-size: small">i2cdetect Cy Cr Ca 1</span></span></span></span></p>  <p><a href="http://images2015.cnblogs.com/blog/112893/201602/112893-20160223161729865-2092809971.png"><span style="font-size: small"><span style="font-size: medium"><img title="image" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-top-width: 0px" alt="image" src="Beaglebone%20Black%E2%80%93I2C%20%E6%8E%A5%20BMP280%20%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E6%B8%A9%E5%BA%A6%20-%20Lepton%20-%20%E5%8D%9A%E5%AE%A2%E5%9B%AD_files/112893-20160223161730380-1414507555.png" height="153" width="446" border="0"></span></span></a></p>  <p><span style="font-size: small"><span style="font-size: medium"><span style="font-size: small">参数 Cy 是无视交互问题直接执行，-r 是 SMBus read byte 命令，-a 是所有地址，1 是指 i2c-1。</span></span></span></p>  <p><span style="font-size: small"><span style="font-size: medium"><span style="font-size: small">上图的 UU 是代表系统驱动已占用，刚才说的没被占用就是指这些。</span></span></span></p>  <blockquote>   <p><span style="font-size: small"><span style="font-size: medium"><span style="font-size: small">如
果各位在试 I2C 而你的的 I2C 元件地址刚好是 0x54 至 0x57，你可以启用另一个 I2C，I2C-2 ，一次性连接的做法是 
echo BB-I2C2 &gt; /sys/devices/bone-capemgr.9/slots，然后它就会在 i2cdetect Cl 
里面出现，/dev/ 里面也有多了一个 i2c-2。要开机自动启用的话请自行修改开机档启用。</span></span></span></p> </blockquote>  <p><span style="font-size: small"><span style="font-size: medium"><span style="font-size: small">上图可见，其他元件的地址出现了，0x68 是我的九轴芯片 MPU9250，请无视。0x76 才是这次要通信的 <b style="color:black;background-color:#ffff66">BMP280</b>，0x76 就是说明书第28页介绍 I2C 上说的地址：</span></span></span></p>  <p><a href="http://images2015.cnblogs.com/blog/112893/201602/112893-20160223161731036-2135390581.png"><span style="font-size: small"><span style="font-size: medium"><span style="font-size: small"><img title="image" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-top-width: 0px" alt="image" src="Beaglebone%20Black%E2%80%93I2C%20%E6%8E%A5%20BMP280%20%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E6%B8%A9%E5%BA%A6%20-%20Lepton%20-%20%E5%8D%9A%E5%AE%A2%E5%9B%AD_files/112893-20160223161731896-1213819977.png" height="443" width="621" border="0"></span></span></span></a></p>  <p><span style="font-size: small"><span style="font-size: medium"><span style="font-size: small">由于这 <b style="color:black;background-color:#ffff66">BMP280</b> 与九轴是集成在一起成为一个模块，我貌似是没办法控制 SDO 拉高拉低，不过地址不是 1110110 (0x76) 就是 1110111 （0x77）的了，经 i2cdetect 证实是前者 0x76（就是原理图上 九轴的 SDO 和 <b style="color:black;background-color:#ffff66">BMP280</b> 的 SDO 是一起拉低了，“Connecting SDO to GDN results in slave address 1110110(0x76)”）。</span></span></span></p>  <p>&nbsp;</p>  <h2>读取 256 个 register 值</h2>  <p><span style="font-size: small"><span style="font-size: medium"><span style="font-size: small">其实<b style="color:black;background-color:#ffff66">BMP280</b>
 没有 256 个，但 i2cdump 默认是 0x00 至 0xFF 寄存器地址的，SPI 交互时 MSB（bit 7） 是 R/W，值 1 
时候是读取，地址 7 bit 长，所以下图是 10000000（0x80）开始的。挑剔一点的话，应该指定 i2cdump 范围，由 0x80 至
 0xFF。</span></span></span></p>  <p><span style="font-size: small"><span style="font-size: medium"><span style="font-size: small">查到I2C地址后，我用 i2cdump 把 register 全部 dump 出来看看，快捷方便，（据说这样操作对个别元件有风险，但 <b style="color:black;background-color:#ffff66">BMP280</b> 不在此列，详情请自行参考 i2cdetect 和 i2cdump 的相关说明）：</span></span></span></p>  <p><span style="font-family: consolas"><span style="font-size: small"><span style="font-size: medium"><span style="font-size: small">i2cdump Cy 1 0x76</span></span></span></span></p>  <p><a href="http://images2015.cnblogs.com/blog/112893/201602/112893-20160223161732552-1993244141.png"><span style="font-size: small"><span style="font-size: medium"><span style="font-size: small"><img title="image" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-top-width: 0px" alt="image" src="Beaglebone%20Black%E2%80%93I2C%20%E6%8E%A5%20BMP280%20%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E6%B8%A9%E5%BA%A6%20-%20Lepton%20-%20%E5%8D%9A%E5%AE%A2%E5%9B%AD_files/112893-20160223161733177-751452891.png" height="294" width="515" border="0"></span></span></span></a></p>  <p><span style="font-size: small"><span style="font-size: medium"><span style="font-size: small">参数 Cy 是无视交互问题直接执行，1 是指 i2c-1，0x76 是元件的 I2C 地址。</span></span></span></p>  <p>&nbsp;</p>  <h2><b style="color:black;background-color:#ffff66">BMP280</b> Device ID</h2>  <p><span style="font-size: small"><span style="font-size: medium"><span style="font-size: small">很多其他元件的 ID 地址都是 0x00，这设计师把 Device ID 放了在 D0，上图 i2cdump 可见，0xD0 (<span style="font-family: consolas">d0</span>) 值为 0x58，与说明书 4.3.1 所示的一致：</span></span></span></p>  <p><a href="http://images2015.cnblogs.com/blog/112893/201602/112893-20160223161734177-1398358097.png"><span style="font-size: small"><span style="font-size: medium"><span style="font-size: small"><img title="image" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-top-width: 0px" alt="image" src="Beaglebone%20Black%E2%80%93I2C%20%E6%8E%A5%20BMP280%20%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E6%B8%A9%E5%BA%A6%20-%20Lepton%20-%20%E5%8D%9A%E5%AE%A2%E5%9B%AD_files/112893-20160223161734583-1100778103.png" height="104" width="635" border="0"></span></span></span></a></p>  <p>&nbsp;</p>  <h2>温度补偿与温度测量原始值 Register</h2>  <p><span style="font-size: small"><span style="font-size: medium"><span style="font-size: small">然后看看我关心的温度在哪里，说明书上有两个部分的地址是温度相关的，从 register 地址顺序来说，0x88 至 0x8D 是温度补偿值合共三个，和 0xFA 至 0xFC 温度测量结果，温度原始值。</span></span></span></p>  <p><span style="font-size: small"><span style="font-size: medium"><span style="font-size: small">首先温度补偿值，看看说明书怎么讲：</span></span></span></p>  <p><a href="http://images2015.cnblogs.com/blog/112893/201602/112893-20160223161735552-1639106689.png"><span style="font-size: small"><span style="font-size: medium"><span style="font-size: small"><img title="image" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-top-width: 0px" alt="image" src="Beaglebone%20Black%E2%80%93I2C%20%E6%8E%A5%20BMP280%20%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E6%B8%A9%E5%BA%A6%20-%20Lepton%20-%20%E5%8D%9A%E5%AE%A2%E5%9B%AD_files/112893-20160223161736443-1920882189.png" height="424" width="542" border="0"></span></span></span></a></p>  <p><span style="font-size: small"><span style="font-size: medium"><span style="font-size: small">dig_T1
 至 dig_T3 是温度补偿值。我一开始大意，没看出这个坑，你看出来了么？LSB 和 MSB 地址是反的，我傻了拿着 LSB 以为是 MSB 
花了两个晚上反复计算和检查后，才发现自己这个错误，在这里温馨提示，要取温度补偿，记得看清楚它的 LSB 地址和 MSB 
地址，希望大家不要步我后尘。</span></span></span></p>  <p><span style="font-size: small"><span style="font-size: medium"><span style="font-size: small">dig_P1 至 dig_P9 是气压相关的补偿值，本实验我不关心这些。</span></span></span></p>  <p><span style="font-size: small"><span style="font-size: medium"><span style="font-size: small">然后是温度的测量值，说明书的 4.2 Memory map 可以看到是 0xFA 至 0xFC，这次没有反了，0xFA 是 MSB：</span></span></span></p>  <p><a href="http://images2015.cnblogs.com/blog/112893/201602/112893-20160223161737130-120691092.png"><span style="font-size: small"><span style="font-size: medium"><span style="font-size: small"><img title="image" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-top-width: 0px" alt="image" src="Beaglebone%20Black%E2%80%93I2C%20%E6%8E%A5%20BMP280%20%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E6%B8%A9%E5%BA%A6%20-%20Lepton%20-%20%E5%8D%9A%E5%AE%A2%E5%9B%AD_files/112893-20160223161737802-809993930.png" height="425" width="893" border="0"></span></span></span></a></p>  <p><span style="font-size: small"><span style="font-size: medium"><span style="font-size: small">注
意，temp_xlsb (0xFC）是 &lt;7:4&gt;，temp_xlsb 地址的 bit0 至 bit3 
值是零，永远都是零，没有用到的（说明书也写着“Both pressure and temperature values are expected
 to be received in 20 bit format, positive ......”）。</span></span></span></p>  <p><span style="font-size: small"><span style="font-size: medium"><span style="font-size: small">就是说，要取得温度原始值，需要读取 0xFA，0xFB，0xFC 三个接在一起，去掉最后四个 bit 即可。</span></span></span></p>  <p>&nbsp;</p>  <h2>运行模式</h2>  <p><span style="font-size: small"><span style="font-size: medium"><span style="font-size: small">在 Reset 状态时候，MSB 值是 0x80，LSB 和 XLSB 是 0x00，从之前 dump 的结果可以验证，启动后什么都还没做的时候，是 reset state，值就是 0x80。</span></span></span></p>  <p><a href="http://images2015.cnblogs.com/blog/112893/201602/112893-20160223161738661-393150207.png"><span style="font-size: small"><span style="font-size: medium"><span style="font-size: small"><img title="]}L(_M6M(29%%WBBPVOAN[K" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-top-width: 0px" alt="]}L(_M6M(29%%WBBPVOAN[K" src="Beaglebone%20Black%E2%80%93I2C%20%E6%8E%A5%20BMP280%20%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E6%B8%A9%E5%BA%A6%20-%20Lepton%20-%20%E5%8D%9A%E5%AE%A2%E5%9B%AD_files/112893-20160223161739552-295554862.png" height="260" width="379" border="0"></span></span></span></a></p>  <h2><span style="font-size: small"><span style="font-size: medium; font-weight: normal"><span style="font-size: small">这
是省电模式嘛。要启动它，最简单的办法就是用 i2cset 对执行模式的 register 写入值，让它测量然后放置值于 0xFA 至 0xFC 
内。ctrl_meas 0xF4 就是控制相关的 register，从 4.2 Memory Map 可见，0xF4 的 8 bit 
值分成了三个部分，osrs_t（3 bit）、osrs_p（3 bit） 和 mode（2 bit），分别代表温度和气压的 
oversampling （精度）和 mode 模式。做个试验而已不讲究了，全部调成 1就是全开。写入 0xFF 进去 0xF4 它就工作了：</span></span></span></h2>  <p><span style="font-family: consolas"><span style="font-size: small"><span style="font-size: medium"><span style="font-size: small">i2cset Cy 1 0x76 0xF4 0xFF</span></span></span></span></p>  <p><a href="http://images2015.cnblogs.com/blog/112893/201602/112893-20160223161740271-340190789.png"><span style="font-size: small"><span style="font-size: medium"><span style="font-size: small"><img title="image" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-top-width: 0px" alt="image" src="Beaglebone%20Black%E2%80%93I2C%20%E6%8E%A5%20BMP280%20%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E6%B8%A9%E5%BA%A6%20-%20Lepton%20-%20%E5%8D%9A%E5%AE%A2%E5%9B%AD_files/112893-20160223161741208-1394569676.png" height="43" width="352" border="0"></span></span></span></a></p>  <p><span style="font-size: small"><span style="font-size: medium"><span style="font-size: small">然后 dump 出来看看：</span></span></span></p>  <p><a href="http://images2015.cnblogs.com/blog/112893/201602/112893-20160223164550755-157874750.png"><span style="font-size: small"><span style="font-size: medium"><span style="font-size: small"><img title="L(Y$YORON9}A`}4CK0KC$@6" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-top-width: 0px" alt="L(Y$YORON9}A`}4CK0KC$@6" src="Beaglebone%20Black%E2%80%93I2C%20%E6%8E%A5%20BMP280%20%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E6%B8%A9%E5%BA%A6%20-%20Lepton%20-%20%E5%8D%9A%E5%AE%A2%E5%9B%AD_files/112893-20160223164552193-2007169163.png" height="350" width="463" border="0"></span></span></span></a></p>  <p><span style="font-size: small"><span style="font-size: medium"><span style="font-size: small">这次 0xFA 到 0xFC 都有值了。</span></span></span></p>  <p>&nbsp;</p>  <h2>计算温度值</h2>  <p><span style="font-size: small"><span style="font-size: medium"><span style="font-size: small">用计算器算算现在温度多少 ~ 公式如下，来自说明书的：</span></span></span></p>  <p><a href="http://images2015.cnblogs.com/blog/112893/201602/112893-20160223161743333-1306727476.png"><span style="font-size: small"><span style="font-size: medium"><span style="font-size: small"><img title="image" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-top-width: 0px" alt="image" src="Beaglebone%20Black%E2%80%93I2C%20%E6%8E%A5%20BMP280%20%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E6%B8%A9%E5%BA%A6%20-%20Lepton%20-%20%E5%8D%9A%E5%AE%A2%E5%9B%AD_files/112893-20160223161743849-477168676.png" height="147" width="801" border="0"></span></span></span></a></p>  <p><span style="font-size: small"><span style="font-size: medium"><span style="font-size: small">上图中的 <b style="color:black;background-color:#ffff66">BMP280</b>_S32_t 数据类型是 32 bit signed integer。adc_T 就是 0xFA 至 0xFC 去掉 4 bit 后的值，dig_T1 至 dig_T3 补偿值中 T1 是 unsigned，T2 和 T3 是 signed，转换见下表：</span></span></span></p>  <table style="width: 852px" cellpadding="2" cellspacing="0" border="1"><tbody>     <tr>       <td valign="top" width="80"><span style="font-family: consolas"><span style="font-size: small">Register</span></span></td>        <td valign="top" width="258"><span style="font-family: consolas"><span style="font-size: small">Addresses &amp; Values (MSB first)</span></span></td>        <td valign="top" width="59"><span style="font-family: consolas"><span style="font-size: small">HEX</span></span></td>        <td valign="top" width="228"><span style="font-family: consolas"><span style="font-size: small">Binary</span></span></td>        <td valign="top" width="83"><span style="font-family: consolas"><span style="font-size: small">Signed ?</span></span></td>        <td valign="top" width="142"><span style="font-family: consolas"><span style="font-size: small">Actual Dec Value</span></span></td>     </tr>      <tr>       <td valign="top" width="80"><span style="font-family: consolas"><span style="font-size: small">adc_T</span></span></td>        <td valign="top" width="258"><span style="font-family: consolas"><span style="font-size: small">0xFA = 7B, 0xFB = BB, 0xFC = 60</span></span></td>        <td valign="top" width="59"><span style="font-family: consolas"><span style="font-size: small">7BBB6(*)</span></span></td>        <td valign="top" width="228"><span style="font-family: consolas"><span style="font-size: small">01111011 10111011 0110 (*)</span></span></td>        <td valign="top" width="83"><span style="font-family: consolas"><span style="font-size: small">YES</span></span></td>        <td valign="top" width="142"><span style="font-family: consolas"><span style="font-size: small">506806</span></span></td>     </tr>      <tr>       <td valign="top" width="80"><span style="font-family: consolas"><span style="font-size: small">dig_T1</span></span></td>        <td valign="top" width="258"><span style="font-family: consolas"><span style="font-size: small">0x89 = 6D, 0x88 = DB</span></span></td>        <td valign="top" width="59"><span style="font-family: consolas"><span style="font-size: small">6DDB</span></span></td>        <td valign="top" width="228"><span style="font-family: consolas"><span style="font-size: small">01101101 11011011</span></span></td>        <td valign="top" width="83"><span style="font-family: consolas"><span style="font-size: small">NO</span></span></td>        <td valign="top" width="142"><span style="font-family: consolas"><span style="font-size: small">28123</span></span></td>     </tr>      <tr>       <td valign="top" width="80"><span style="font-family: consolas"><span style="font-size: small">dig_T2</span></span></td>        <td valign="top" width="258"><span style="font-family: consolas"><span style="font-size: small">0x8B = 67, 0x8A = 39</span></span></td>        <td valign="top" width="59"><span style="font-family: consolas"><span style="font-size: small">6739</span></span></td>        <td valign="top" width="228"><span style="font-family: consolas"><span style="font-size: small">01100111 00111001</span></span></td>        <td valign="top" width="83"><span style="font-family: consolas"><span style="font-size: small">YES</span></span></td>        <td valign="top" width="142"><span style="font-family: consolas"><span style="font-size: small">26425</span></span></td>     </tr>      <tr>       <td valign="top" width="80"><span style="font-family: consolas"><span style="font-size: small">dig_T3</span></span></td>        <td valign="top" width="258"><span style="font-family: consolas"><span style="font-size: small">0x8D = FC, 0x8C = 18</span></span></td>        <td valign="top" width="59"><span style="font-family: consolas"><span style="font-size: small">FC18</span></span></td>        <td valign="top" width="228"><span style="font-family: consolas"><span style="font-size: small">11111100 00011000</span></span></td>        <td valign="top" width="83"><span style="font-family: consolas"><span style="font-size: small">YES</span></span></td>        <td valign="top" width="142"><span style="font-family: consolas"><span style="font-size: small">-1000</span></span></td>     </tr>      <tr>       <td valign="top" width="80"><span style="font-family: consolas"><span style="font-size: small">var1</span></span></td>        <td valign="top" width="258"><span style="font-size: small"><span style="font-family: consolas">&nbsp;</span></span></td>        <td valign="top" width="59"><span style="font-size: small"><span style="font-family: consolas">&nbsp;</span></span></td>        <td valign="top" width="228"><span style="font-size: small"><span style="font-family: consolas">&nbsp;</span></span></td>        <td valign="top" width="83"><span style="font-family: consolas"><span style="font-size: small">YES</span></span></td>        <td valign="top" width="142"><span style="font-family: consolas"><span style="font-size: small">91671.395874023438</span></span></td>     </tr>      <tr>       <td valign="top" width="80"><span style="font-family: consolas"><span style="font-size: small">var2</span></span></td>        <td valign="top" width="258"><span style="font-size: small"><span style="font-family: consolas">&nbsp;</span></span></td>        <td valign="top" width="59"><span style="font-size: small"><span style="font-family: consolas">&nbsp;</span></span></td>        <td valign="top" width="228"><span style="font-size: small"><span style="font-family: consolas">&nbsp;</span></span></td>        <td valign="top" width="83"><span style="font-family: consolas"><span style="font-size: small">YES</span></span></td>        <td valign="top" width="142"><span style="font-family: consolas"><span style="font-size: small">-188.04323882795870</span></span></td>     </tr>      <tr>       <td valign="top" width="80"><span style="font-family: consolas"><span style="font-size: small">T 实际温度</span></span></td>        <td valign="top" width="258"><span style="font-size: small"><span style="font-family: consolas">&nbsp;</span></span></td>        <td valign="top" width="59"><span style="font-size: small"><span style="font-family: consolas">&nbsp;</span></span></td>        <td valign="top" width="228"><span style="font-size: small"><span style="font-family: consolas">&nbsp;</span></span></td>        <td valign="top" width="83"><span style="font-family: consolas"><span style="font-size: small">YES</span></span></td>        <td valign="top" width="142"><span style="font-family: consolas"><span style="font-size: small">17.867842</span></span></td>     </tr>   </tbody></table>  <p><em><span style="font-size: small"><span style="font-size: medium"><span style="font-size: small">(*) 去掉 bit3 至 bit0</span></span></span></em></p>  <p>&nbsp;</p>  <p><span style="font-size: small"><span style="font-size: medium"><span style="font-size: small">成功，17.86 °C，凉快。最后是官方的 C 代码温度补偿、和转换原始温度值和°C的，供参考。注：当然需要自行 define <b style="color:black;background-color:#ffff66">BMP280</b>_S32_t ，类型为 32 bit Signed Integer。</span></span></span></p>  <pre class="prettyprint">// Returns temperature in DegC, resolution is 0.01 DegC. Output value of “<a name="baidusnap2"></a><b style="color:black;background-color:#99ff99">51</b>23” equals <b style="color:black;background-color:#99ff99">51</b>.23 DegC. 
// t_fine carries fine temperature as global value 
<b style="color:black;background-color:#ffff66">BMP280</b>_S32_t t_fine; 
<b style="color:black;background-color:#ffff66">BMP280</b>_S32_t <b style="color:black;background-color:#ffff66">bmp280</b>_compensate_T_int32(<b style="color:black;background-color:#ffff66">BMP280</b>_S32_t adc_T) 
{ 
  <b style="color:black;background-color:#ffff66">BMP280</b>_S32_t var1, var2, T; 
  var1 = ((((adc_T&gt;&gt;3) - ((<b style="color:black;background-color:#ffff66">BMP280</b>_S32_t)dig_T1&lt;&lt;1))) * ((<b style="color:black;background-color:#ffff66">BMP280</b>_S32_t)dig_T2)) &gt;&gt; 11; 
  var2 = (((((adc_T&gt;&gt;4) - ((<b style="color:black;background-color:#ffff66">BMP280</b>_S32_t)dig_T1)) * ((adc_T&gt;&gt;4) - ((<b style="color:black;background-color:#ffff66">BMP280</b>_S32_t)dig_T1))) &gt;&gt; 12) * 
    ((<b style="color:black;background-color:#ffff66">BMP280</b>_S32_t)dig_T3)) &gt;&gt; 14; 
  t_fine = var1 + var2; 
  T = (t_fine * 5 + 128) &gt;&gt; 8; 
  return T; 
}</pre>

<p><span style="font-size: small"><span style="font-size: medium"><span style="font-size: small">我用以上的代码算不出来，估计是跟 BBB 数据类型的大小有关，需要调整类型和/或 bit shift 大小，没研究了不管了。</span></span></span></p>

<h2>C 代码（输出 256 个 register 值）</h2>

<p><span style="font-size: small"><span style="font-size: medium"><span style="font-size: small">首先来个 C 代码 dump 出来：</span></span></span></p>

<pre class="prettyprint linenums">/* 
* app.c 
* 
*  Created on: 2016-2-23 
*      Author: Lepton 
*/ 
#include&lt;stdio.h&gt; 
#include&lt;fcntl.h&gt; 
#include&lt;sys/ioctl.h&gt; 
#include&lt;linux/i2c.h&gt; 
#include&lt;linux/i2c-dev.h&gt;

#define DEVID 0xD0 
#define BUFFER_SIZE 256

int main(){ 
        int file; 
        if((file=open("/dev/i2c-1", O_RDWR)) &lt; 0) { 
                perror("failed to open the bus\n"); 
                return 1; 
        } 
        if(ioctl(file, I2C_SLAVE, 0x76) &lt; 0) { 
                perror("Failed to connect to the sensor\n"); 
                return 1; 
        } 
        char writeBuffer[1] = {0x00} ; 
        if(write(file, writeBuffer, 1)!=1) { 
                perror("Failed to reset the read address\n"); 
                return 1; 
        } 
        char readBuffer[BUFFER_SIZE]; 
        if(read(file, readBuffer, BUFFER_SIZE)!=BUFFER_SIZE){ 
                perror("Failed to read in the buffer\n"); 
                return 1; 
        } 
        int i; 
        printf("Device ID: 0x%02x\n", readBuffer[DEVID]); 
        for (i = 0; i&lt;BUFFER_SIZE; i++){ 
                if(i!=0 &amp;&amp; i%16==0) printf("\n"); 
                printf("%02x ",readBuffer[i]); 
        } 
        printf("\n"); 
        close(file); 
        return 0; 
}</pre>

<p><span style="font-size: small; font-family: consolas"><span style="font-size: medium"><span style="font-size: small">
        <br></span></span></span></p>

<p><span style="font-size: small"><span style="font-size: medium"><span style="font-size: small">256 bytes 一口气读出来，耗内存狂是我。效果：</span></span></span></p>

<p><a href="http://images2015.cnblogs.com/blog/112893/201602/112893-20160224021742271-292937831.png"><span style="font-size: small"><span style="font-size: medium"><span style="font-size: small"><img title="image" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-top-width: 0px" alt="image" src="Beaglebone%20Black%E2%80%93I2C%20%E6%8E%A5%20BMP280%20%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E6%B8%A9%E5%BA%A6%20-%20Lepton%20-%20%E5%8D%9A%E5%AE%A2%E5%9B%AD_files/112893-20160224021743630-494045196.png" height="305" width="407" border="0"></span></span></span></a></p>

<p><span style="font-size: small"><span style="font-size: medium"><span style="font-size: small">以上代码改自于 Exploring Beaglebone 一书上的示范。</span></span></span></p>

<p>&nbsp;</p>

<h2>C 代码 （获取温度值）</h2>

<p><span style="font-size: small"><span style="font-size: medium"><span style="font-size: small">再来，正式获取温度了，这次要省省内存，分开了两个独立方法做写入 register 与读取，读取时，只读仅需要的 byte。这次只打开温度计，不管气压不测量。另外，温度补偿部分的数据其实基本不变的，所以，我分开了两次读取，相隔几毫秒没有太大关系：</span></span></span></p>

<pre class="prettyprint linenums">/* 
* app.c 
* 
*  Created on: 2016-2-23 
*      Author: Lepton 
*/ 
#include&lt;stdio.h&gt; 
#include&lt;stdint.h&gt; 
#include&lt;fcntl.h&gt; 
#include&lt;sys/ioctl.h&gt; 
#include&lt;linux/i2c.h&gt; 
#include&lt;linux/i2c-dev.h&gt;

#define <b style="color:black;background-color:#ffff66">BMP280</b>_ADD 
0x76 
#define DIG_START 0x88 
#define TEMP_START 0xFA 
#define CTRL_MEAS 0xF4 
#define TEMP_ONLY_NORMAL_MODE 0xE3 // 111 000 11

int writeReg(int pt, unsigned char add, char value){ 
        unsigned char w_buff[2]; 
        w_buff[0] = add; 
        w_buff[1] = value; 
        if (write(pt, w_buff, 2) != 2){ 
                perror("Failed write to device"); 
                return 1; 
        } 
        return 0; 
} 
int readReg(int pt, unsigned char s_add, char buf[], int size){ 
        char writeBuff[1] = {s_add}; 
        if(write(pt, writeBuff, 1)!=1) { 
                perror("Failed to reset the read address\n"); 
                return 1; 
        } 
        if(read(pt, buf, size)!=size){ 
                perror("Failed to read in the buffer\n"); 
                return 1; 
        } 
        return 0; 
}

float myFunc(uint32_t adc_T, unsigned short dig_T1, short dig_T2, short 
dig_T3){ 
        uint32_t var1, var2; 
        float T; 
        var1 = 
(((double)adc_T)/16384.0-((double)dig_T1)/1024.0)*((double)dig_T2); 
        var2 = 
((((double)adc_T)/131072.0-((double)dig_T1)/8192.0)*(((double)adc_T)/131072.0-((double)dig_T1)/8192.0))*((double)dig_T2);
 
        T = (var1+var2)/<b style="color:black;background-color:#99ff99">51</b>20.0; 
        return T; 
}

int main(){ 
        int file; 
        if((file=open("/dev/i2c-1", O_RDWR)) &lt; 0) { 
                perror("failed to open the bus\n"); 
                return 1; 
        } 
        if(ioctl(file, I2C_SLAVE, <b style="color:black;background-color:#ffff66">BMP280</b>_ADD) &lt; 0) { 
                perror("Failed to connect to the sensor\n"); 
                return 1; 
        }

        char dig_buff[6]; 
        char tmp_buff[3];

        if(writeReg(file, CTRL_MEAS, TEMP_ONLY_NORMAL_MODE)==1){ 
                return 1; 
        } 
        if(readReg(file, DIG_START, dig_buff, 6)==1){ 
                return 1; 
        } 
        if(readReg(file, TEMP_START, tmp_buff, 3)==1){ 
                return 1; 
        } 
        close(file);

        printf("Dump :\n"); 
        int i; 
        for (i=0; i&lt;6; i++){ 
                printf("%02x ",dig_buff[i]); 
        } 
        printf("\n"); 
        for (i=0; i&lt;3; i++){ 
                printf("%02x ",tmp_buff[i]); 
        } 
        printf("\n"); 
        int adc_T = ((tmp_buff[0]&lt;&lt;16)|(tmp_buff[1]&lt;&lt;8)|(tmp_buff[2]))&gt;&gt;4; 
        unsigned short dig_T1 = (dig_buff[1]&lt;&lt;8)|(dig_buff[0]); 
        short dig_T2 = (dig_buff[3]&lt;&lt;8)|(dig_buff[2]); 
        short dig_T3 = (dig_buff[5]&lt;&lt;8)|(dig_buff[4]); 
        printf("adc_T is : %d \n", adc_T); 
        printf("dig_T1 is : %d \n", dig_T1); 
        printf("dig_T2 is : %d \n", dig_T2); 
        printf("dig_T3 is : %d \n", dig_T3); 
        printf("Temperature is : %f \n", myFunc(adc_T, dig_T1, dig_T2, dig_T3)); 
        return 0; 
}</pre>

<p>&nbsp;</p>

<p><span style="font-size: small"><span style="font-size: medium"><span style="font-size: small">效果：</span></span></span></p>

<p><a href="http://images2015.cnblogs.com/blog/112893/201602/112893-20160224021744349-939332390.png"><span style="font-size: medium"><span style="font-size: small"><img title="image" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-top-width: 0px" alt="image" src="Beaglebone%20Black%E2%80%93I2C%20%E6%8E%A5%20BMP280%20%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E6%B8%A9%E5%BA%A6%20-%20Lepton%20-%20%E5%8D%9A%E5%AE%A2%E5%9B%AD_files/112893-20160224021745240-1217208184.png" height="196" width="538" border="0"></span></span></a></p>

<p><span style="font-size: small"><span style="font-size: medium"><span style="font-size: small">还有那些看到就烦的拼音档案名呢 ~ 现在几度了~ 17.02°C ~</span></span></span></p>

<p><span style="font-size: small"><span style="font-size: medium"><span style="font-size: small">今天到此为止。</span></span></span></p>
<p>我在这群里，欢迎加入交流：<br>
<a target="_blank" href="http://jq.qq.com/?_wv=1027&amp;k=40Z5FYV"><img title="开发板玩家群 578649319" alt="开发板玩家群 578649319" src="Beaglebone%20Black%E2%80%93I2C%20%E6%8E%A5%20BMP280%20%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E6%B8%A9%E5%BA%A6%20-%20Lepton%20-%20%E5%8D%9A%E5%AE%A2%E5%9B%AD_files/group.gif"></a>开发板玩家群 578649319<br>
<a target="_blank" href="http://shang.qq.com/wpa/qunwpa?idkey=8099fe02a156a8d1fcd46d44ec60d97dad77793d8aad5921fa56406c21d4d601"><img title="硬件创客 (10105555)" alt="硬件创客 (10105555)" src="Beaglebone%20Black%E2%80%93I2C%20%E6%8E%A5%20BMP280%20%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E6%B8%A9%E5%BA%A6%20-%20Lepton%20-%20%E5%8D%9A%E5%AE%A2%E5%9B%AD_files/group.gif"></a>硬件创客 (10105555)</p></div><div id="MySignature"></div>
<div class="clear"></div>
<div id="blog_post_info_block">
<div id="BlogPostCategory"></div>
<div id="EntryTag"></div>
<div id="blog_post_info">
</div>
<div class="clear"></div>
<div id="post_next_prev"></div>
</div>


		</div>
		<div class="postDesc">posted @ <span id="post-date">2016-02-23 16:18</span> <a href="http://www.cnblogs.com/leptonation/">Lepton</a> 阅读(<span id="post_view_count">...</span>) 评论(<span id="post_comment_count">...</span>)  <a href="https://i.cnblogs.com/EditPosts.aspx?postid=5210331" rel="nofollow">编辑</a> <a href="#" onclick="AddToWz(5210331);return false;">收藏</a></div>
	</div>
	
	
</div><!--end: topics 文章、评论容器-->
</div><a name="!comments"></a><div id="blog-comments-placeholder"></div>
<div id="comment_form" class="commentform">
<a name="commentform"></a>
<div id="divCommentShow"></div>
<div id="comment_nav"><span id="span_refresh_tips"></span><a href="javascript:void(0);" onclick="return RefreshCommentList();" id="lnk_RefreshComments" runat="server" clientidmode="Static">刷新评论</a><a href="#" onclick="return RefreshPage();">刷新页面</a><a href="#top">返回顶部</a></div>
<div id="comment_form_container"></div>
<div class="ad_text_commentbox" id="ad_text_under_commentbox"></div>
<div id="ad_t2"></div>
<div id="opt_under_post"></div>
<div id="cnblogs_c1" class="c_ad_block"></div>
<div id="under_post_news"></div>
<div id="cnblogs_c2" class="c_ad_block"></div>
<div id="under_post_kb"></div>
<div id="HistoryToday" class="c_ad_block"></div>

</div>


	</div><!--end: forFlow -->
	</div><!--end: mainContent 主体内容容器-->

	<div id="sideBar">
		<div id="sideBarMain">
			
			<div id="blog-calendar" style="display:none"></div>
			
			<div id="leftcontentcontainer">
				<div id="blog-sidecolumn"></div>
			</div>
			
		</div><!--end: sideBarMain -->
	</div><!--end: sideBar 侧边栏容器 -->
	<div class="clear"></div>
	</div><!--end: main -->
	<div class="clear"></div>
	<div id="footer">
		
<!--done-->
Copyright &#169;2017 Lepton
	</div><!--end: footer -->
</div><!--end: home 自定义的最大容器 -->
<!--PageEndHtml Block Begin-->

<!--PageEndHtml Block End-->



</div>



</body></html>